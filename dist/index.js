"use strict";var e=require("path"),n=require("@babel/parser"),t=require("@babel/traverse"),r=require("@babel/generator"),o=require("@babel/types");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}})),n.default=e,Object.freeze(n)}var a=i(e),u=i(t),c=i(r),l=s(o);function m(e){const n=l.program([],[],"script");return l.addComment(n,"inner","==UserScript==",!0),(null==e?void 0:e.length)&&l.addComments(n,"inner",e),l.addComment(n,"inner","==/UserScript==",!0),n}module.exports=function(e){let t=[];return{name:"rollup-plugin-userscript-responsive-develop",transform(e){let{metaCommentArr:r,script:o}=function(e){const t=n.parse(e,{sourceType:"unambiguous"}),r=e=>"CommentLine"==e.type&&e.value.includes("==UserScript=="),o=e=>"CommentLine"==e.type&&e.value.includes("==/UserScript==");return{metaCommentArr:function(e){let n=[];function t(e){if(e)for(;e.length;){const t=e.findIndex(r),i=e.findIndex(o);if(-1==t||-1==i)break;let s=e.splice(t,i-t+1);s.shift(),s.pop(),n=n.concat(s)}}return u.default(e,{enter(e){t(e.node.leadingComments),t(e.node.trailingComments)}}),n}(t),script:c.default(t)}}(e);return t=[...t,...r],{code:o.code,map:o.map}},generateBundle(r,o){Object.values(o).forEach((o=>{if("chunk"===o.type)if(null!=e&&e.extractToHeader){if(t.length){const e=m(t);e.body.push(...n.parse(o.code).program.body);const{code:r,map:i}=c.default(e,{inputSourceMap:o.map,sourceMaps:!0});o.code=r,o.map=function(e,n){return n?Object.assign(e,{names:n.names,mappings:n.mappings,sourcesContent:n.sourcesContent}):e}(o.map,i)}}else{const n=function(e,n){if(n){e||(e=l.program([],[],"script"),l.addComment(e,"inner"," ==UserScript==",!0),l.addComment(e,"inner"," ==/UserScript==",!0));const t=` @require file://${n}`;l.addComment(e,"inner",t,!0);const r=e.innerComments.splice(e.innerComments.length-1,1)[0];return e.innerComments.splice(e.innerComments.length-1,0,r),e}}(m(t),a.default.resolve(process.cwd(),r.file));this.emitFile({type:"asset",fileName:(null==e?void 0:e.name)??`debug.${r.file}$`,source:c.default(n).code})}}))}}};
