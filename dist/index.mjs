import e from"node:path";import r from"magic-string";import{full as t}from"acorn-walk";function n(n={}){let o=[];return{name:"rollup-plugin-userscript-responsive-develop",transform(e){let n=new r(e),i=!1;const a=this.parse(e,{onComment:(e,r,t,a)=>{if(!e){if(r.includes("==UserScript=="))return i=!0,void n.remove(t,a);if(r.includes("==/UserScript=="))return i=!1,void n.remove(t,a);i&&(o.push(r.trim()),n.remove(t,a))}}});return t(a,(e=>{n.addSourcemapLocation(e.start),n.addSourcemapLocation(e.end)})),{code:n.toString(),map:n.generateMap({includeContent:!0})}},generateBundle(r,t){Object.values(t).forEach((t=>{if("chunk"===t.type){if(n?.extractToExternal){const t=o.reduce(((e,r)=>{const t=r.match(/@\w+\s+/)?.length??-8;return Math.max(t,e)}),1);o=[...o,`@require${" ".repeat(t)}file://${e.resolve(process.cwd(),r.file)}`]}if(!o.length)return;o=["==UserScript==",...o,"==/UserScript=="];const i=o.map((e=>`// ${e}\n`)).join("");n?.extractToExternal?this.emitFile({type:"asset",fileName:n?.name??`debug.${r.file}$`,source:i}):(t.code=`${i}\n${t.code}`,t.map.mappings=`${";".repeat(o.length)}${t.map.mappings}`)}}))}}}export{n as default};
